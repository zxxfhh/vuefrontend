<?xml version="1.0" encoding="UTF-8"?>
<svg width="80" height="140" viewBox="0 0 80 140" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <!-- é»˜è®¤æ¶²ä½“æ¸å˜ï¼ˆè“åˆ°çº¢ï¼‰ -->
    <linearGradient id="thermometer-liquid-gradient" x1="0%" y1="100%" x2="0%" y2="0%">
      <stop offset="0%" style="stop-color:#2196F3;stop-opacity:1" />
      <stop offset="50%" style="stop-color:#4CAF50;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#FF6B6B;stop-opacity:1" />
    </linearGradient>
  </defs>

  <!-- åº•éƒ¨å¤§åœ†çƒ - å¤–åœˆï¼ˆæ·±ç°è‰²è¾¹æ¡†ï¼Œå›ºå®šé¢œè‰²ï¼‰ -->
  <circle id="thermometer-outer-bulb" cx="28" cy="112" r="22" fill="#f5f5f5" stroke="#3d4852" stroke-width="6"/>

  <!-- çŽ»ç’ƒç®¡ä¸»ä½“ - å¤–å£³ï¼ˆæ·±ç°è‰²ç²—è¾¹æ¡†ï¼Œå›ºå®šé¢œè‰²ï¼‰ -->
  <rect id="thermometer-tube" x="10" y="10" width="36" height="92"
        rx="18" ry="18"
        fill="#f5f5f5"
        stroke="#3d4852"
        stroke-width="6"/>

  <!-- å†…éƒ¨ç™½è‰²èƒŒæ™¯ï¼ˆå›ºå®šé¢œè‰²ï¼‰ -->
  <rect id="thermometer-inner-bg" x="16" y="16" width="24" height="80"
        rx="12" ry="12"
        fill="#ffffff"
        stroke="none"/>

  <!-- ðŸŽ¯ è¿›åº¦æ¡è½¨é“å…ƒç´  - ç”¨äºŽå…¼å®¹è¿›åº¦æ¡åŠ¨ç”»ï¼ˆä¸å¯è§ï¼‰ -->
  <rect id="A-GXP_TRACK"
        x="22"
        y="20"
        width="12"
        height="76"
        fill="none"
        stroke="none"
        opacity="0"/>

  <!-- æ¶²ä½“é€šé“è£å‰ªåŒºåŸŸ -->
  <clipPath id="liquidClip">
    <rect x="22" y="20" width="12" height="76" rx="6" ry="6"/>
  </clipPath>

  <!-- æ¶²ä½“å®¹å™¨ -->
  <g id="liquidContainer" clip-path="url(#liquidClip)">
    <!-- ðŸŽ¯ æ¶²ä½“çŸ©å½¢ - å…¼å®¹è¿›åº¦æ¡åŠ¨ç”»çš„ A-GXP_FILL -->
    <rect id="A-GXP_FILL"
          x="22"
          y="58"
          width="12"
          height="38"
          fill="#FF6B6B"
          style="transform-origin: 50% 100%"/>
  </g>

  <!-- åº•éƒ¨æ¶²ä½“çƒ - å†…åœˆï¼ˆä¸Žæ¶²æŸ±åŒè‰²ï¼Œä¼šè¢«å›¾æ ‡æ•ˆæžœæ”¹å˜ï¼‰ -->
  <circle id="thermometer-bulb" cx="28" cy="112" r="16" fill="#FF6B6B"/>

  <!-- åˆ»åº¦çº¿ç»„ï¼ˆå›ºå®šé¢œè‰²ï¼‰ -->
  <g id="scaleMarks" stroke="#3d4852" stroke-width="3" stroke-linecap="round">
    <line x1="52" y1="24" x2="68" y2="24"/>
    <line x1="52" y1="36" x2="62" y2="36" stroke-width="2.5"/>
    <line x1="52" y1="48" x2="68" y2="48"/>
    <line x1="52" y1="60" x2="62" y2="60" stroke-width="2.5"/>
    <line x1="52" y1="72" x2="68" y2="72"/>
    <line x1="52" y1="84" x2="62" y2="84" stroke-width="2.5"/>
    <line x1="52" y1="96" x2="68" y2="96"/>
  </g>

  <!-- ðŸŒ¡ï¸ æ¸©åº¦æ•°å€¼æ˜¾ç¤º -->
  <text id="A-GXP_LABEL"
        x="28"
        y="58"
        text-anchor="middle"
        dominant-baseline="middle"
        font-size="10"
        font-family="Arial, sans-serif"
        font-weight="bold"
        fill="#3d4852">30â„ƒ</text>

  <script type="text/javascript">
    <![CDATA[
    (function() {
      // ðŸ”‘ èŽ·å–å½“å‰SVGå…ƒç´ 
      var waterShape = document.getElementById('A-GXP_FILL');
      var labelElement = document.getElementById('A-GXP_LABEL');

      if (!waterShape) {
        console.warn('âš ï¸ æ¸©åº¦è®¡åˆå§‹åŒ–å¤±è´¥ï¼šæœªæ‰¾åˆ° A-GXP_FILL å…ƒç´ ');
        return;
      }

      var svgRoot = waterShape;
      while (svgRoot && svgRoot.tagName !== 'svg') {
        svgRoot = svgRoot.parentElement;
      }

      if (!svgRoot) {
        console.error('æ— æ³•æ‰¾åˆ°SVGæ ¹å…ƒç´ ');
        return;
      }

      var bulb = svgRoot.querySelector('#thermometer-bulb');
      var trackElement = svgRoot.querySelector('#A-GXP_TRACK');

      // èŽ·å–ç»“æž„æ€§å…ƒç´ ï¼ˆéœ€è¦ä¿æŒå›ºå®šé¢œè‰²çš„å…ƒç´ ï¼‰
      var structuralElements = {
        outerBulb: svgRoot.querySelector('#thermometer-outer-bulb'),
        tube: svgRoot.querySelector('#thermometer-tube'),
        innerBg: svgRoot.querySelector('#thermometer-inner-bg'),
        scaleMarks: svgRoot.querySelector('#scaleMarks')
      };

      // ä¿å­˜ç»“æž„æ€§å…ƒç´ çš„åŽŸå§‹é¢œè‰²
      var originalColors = {
        outerBulb: { fill: '#f5f5f5', stroke: '#3d4852' },
        tube: { fill: '#f5f5f5', stroke: '#3d4852' },
        innerBg: { fill: '#ffffff', stroke: 'none' },
        scaleMarks: { fill: 'none', stroke: '#3d4852' }
      };

      // é»˜è®¤é…ç½®
      var initValue = 30;
      var _pn_value = initValue;
      var _pn_min = 0;
      var _pn_max = 100;

      // ðŸ” å¼ºåˆ¶æ¢å¤ç»“æž„æ€§å…ƒç´ çš„åŽŸå§‹é¢œè‰²
      function restoreStructuralColors() {
        // å¤–åœˆçƒæ³¡
        if (structuralElements.outerBulb) {
          structuralElements.outerBulb.setAttribute('fill', originalColors.outerBulb.fill);
          structuralElements.outerBulb.setAttribute('stroke', originalColors.outerBulb.stroke);
          structuralElements.outerBulb.style.fill = originalColors.outerBulb.fill;
          structuralElements.outerBulb.style.stroke = originalColors.outerBulb.stroke;
        }

        // çŽ»ç’ƒç®¡
        if (structuralElements.tube) {
          structuralElements.tube.setAttribute('fill', originalColors.tube.fill);
          structuralElements.tube.setAttribute('stroke', originalColors.tube.stroke);
          structuralElements.tube.style.fill = originalColors.tube.fill;
          structuralElements.tube.style.stroke = originalColors.tube.stroke;
        }

        // å†…éƒ¨èƒŒæ™¯
        if (structuralElements.innerBg) {
          structuralElements.innerBg.setAttribute('fill', originalColors.innerBg.fill);
          structuralElements.innerBg.style.fill = originalColors.innerBg.fill;
        }

        // åˆ»åº¦çº¿
        if (structuralElements.scaleMarks) {
          structuralElements.scaleMarks.setAttribute('stroke', originalColors.scaleMarks.stroke);
          structuralElements.scaleMarks.style.stroke = originalColors.scaleMarks.stroke;
        }
      }

      // ä½¿ç”¨ MutationObserver ç›‘å¬æ ·å¼å˜åŒ–ï¼Œè‡ªåŠ¨æ¢å¤ç»“æž„æ€§å…ƒç´ é¢œè‰²
      function setupStyleProtection() {
        var observer = new MutationObserver(function(mutations) {
          var needsRestore = false;
          mutations.forEach(function(mutation) {
            if (mutation.type === 'attributes' &&
                (mutation.attributeName === 'style' ||
                 mutation.attributeName === 'fill' ||
                 mutation.attributeName === 'stroke')) {
              var target = mutation.target;
              // æ£€æŸ¥æ˜¯å¦æ˜¯ç»“æž„æ€§å…ƒç´ è¢«ä¿®æ”¹
              if (target.id === 'thermometer-outer-bulb' ||
                  target.id === 'thermometer-tube' ||
                  target.id === 'thermometer-inner-bg' ||
                  target.id === 'scaleMarks') {
                needsRestore = true;
              }
            }
          });

          if (needsRestore) {
            // å»¶è¿Ÿæ¢å¤ï¼Œç¡®ä¿SvgManagerå®Œæˆæ ·å¼åº”ç”¨
            setTimeout(restoreStructuralColors, 0);
          }
        });

        // ç›‘å¬æ‰€æœ‰ç»“æž„æ€§å…ƒç´ 
        Object.values(structuralElements).forEach(function(el) {
          if (el) {
            observer.observe(el, {
              attributes: true,
              attributeFilter: ['style', 'fill', 'stroke']
            });
          }
        });

        // åŒæ—¶ç›‘å¬SVGæ ¹å…ƒç´ çš„å­æ ‘å˜åŒ–ï¼ˆå…‹éš†æ“ä½œï¼‰
        observer.observe(svgRoot, {
          attributes: true,
          subtree: true,
          attributeFilter: ['style', 'fill', 'stroke']
        });
      }

      // ðŸŽ¯ åŒæ­¥åº•éƒ¨çƒæ³¡é¢œè‰²ï¼ˆç›‘å¬ A-GXP_FILL çš„å˜åŒ–ï¼‰
      function syncBulbColor() {
        if (!bulb || !waterShape) return;

        var observer = new MutationObserver(function(mutations) {
          mutations.forEach(function(mutation) {
            if (mutation.type === 'attributes' &&
                (mutation.attributeName === 'fill' || mutation.attributeName === 'style')) {
              var liquidColor = waterShape.style.fill || waterShape.getAttribute('fill');
              if (liquidColor && !liquidColor.includes('url(')) {
                bulb.style.fill = liquidColor;
                bulb.setAttribute('fill', liquidColor);
              }
            }
          });
        });

        observer.observe(waterShape, {
          attributes: true,
          attributeFilter: ['style', 'fill']
        });

        // ç«‹å³åŒæ­¥ä¸€æ¬¡
        var liquidColor = waterShape.style.fill || waterShape.getAttribute('fill');
        if (liquidColor && !liquidColor.includes('url(')) {
          bulb.style.fill = liquidColor;
          bulb.setAttribute('fill', liquidColor);
        }
      }

      // ðŸŒ¡ï¸ ç›‘å¬æ¶²ä½å˜åŒ–ï¼Œè‡ªåŠ¨æ›´æ–°æ¸©åº¦æ•°å€¼æ˜¾ç¤º
      function setupLabelUpdate() {
        if (!labelElement || !waterShape || !trackElement) return;

        var trackHeight = parseFloat(trackElement.getAttribute('height') || '76');

        var observer = new MutationObserver(function(mutations) {
          mutations.forEach(function(mutation) {
            if (mutation.type === 'attributes' &&
                (mutation.attributeName === 'height' || mutation.attributeName === 'y')) {
              // æ ¹æ®æ¶²ä½é«˜åº¦è®¡ç®—ç™¾åˆ†æ¯”
              var fillHeight = parseFloat(waterShape.getAttribute('height') || '0');
              var percentage = Math.round((fillHeight / trackHeight) * 100);
              percentage = Math.max(0, Math.min(100, percentage));

              // æ›´æ–°æ–‡æœ¬æ˜¾ç¤º
              labelElement.textContent = percentage + 'â„ƒ';
            }
          });
        });

        observer.observe(waterShape, {
          attributes: true,
          attributeFilter: ['height', 'y']
        });

        // ç«‹å³æ›´æ–°ä¸€æ¬¡
        var fillHeight = parseFloat(waterShape.getAttribute('height') || '38');
        var percentage = Math.round((fillHeight / trackHeight) * 100);
        labelElement.textContent = percentage + 'â„ƒ';
      }

      // ðŸŒ¡ï¸ æ›´æ–°æ¸©åº¦è®¡æ¶²ä½é«˜åº¦ï¼ˆæ ¹æ®ç™¾åˆ†æ¯”ï¼‰
      function updateLiquidLevel(pct) {
        if (!waterShape || !trackElement || !labelElement) return;

        // é™åˆ¶èŒƒå›´ 0-100
        pct = Math.max(_pn_min, Math.min(_pn_max, pct));
        var relativePct = ((pct - _pn_min) / (_pn_max - _pn_min)) * 100;
        var displayPct = Math.max(0, Math.min(100, Math.round(relativePct)));

        // æ›´æ–°æ–‡æœ¬æ˜¾ç¤º
        labelElement.textContent = displayPct + 'â„ƒ';

        // è®¡ç®—æ¶²ä½é«˜åº¦å’Œä½ç½®
        var trackHeight = parseFloat(trackElement.getAttribute('height') || '76');
        var trackY = parseFloat(trackElement.getAttribute('y') || '20');
        var fillHeight = trackHeight * (pct - _pn_min) / (_pn_max - _pn_min);
        var fillY = trackY + trackHeight - fillHeight;

        // æ›´æ–°æ¶²ä½çŸ©å½¢çš„ä½ç½®å’Œé«˜åº¦
        waterShape.setAttribute('y', fillY.toString());
        waterShape.setAttribute('height', fillHeight.toString());

        console.log('ðŸŒ¡ï¸ æ›´æ–°æ¸©åº¦è®¡æ¶²ä½:', {
          pct: pct,
          displayPct: displayPct,
          fillHeight: fillHeight,
          fillY: fillY
        });
      }

      // ðŸŽ¯ å…¼å®¹è¿›åº¦æ¡åŠ¨ç”»çš„ putValue æŽ¥å£
      function putValue(idOrValue, value) {
        // å•å‚æ•°ï¼šç›´æŽ¥è®¾ç½®æ¸©åº¦å€¼ï¼ˆä»…æ›´æ–°çƒæ³¡é¢œè‰²ï¼Œä¸æ›´æ–°æ¶²ä½ï¼‰
        if (arguments.length === 1) {
          // æ¸©åº¦è®¡çš„ putValue ä¸ç›´æŽ¥æ›´æ–°æ¶²ä½
          // æ¶²ä½ç”± SvgManager çš„è¿›åº¦æ¡åŠ¨ç”»æŽ§åˆ¶
          console.log('ðŸŒ¡ï¸ æ¸©åº¦è®¡ putValue (å•å‚æ•°):', idOrValue);
          return;
        }

        // åŒå‚æ•°ï¼šå±žæ€§è®¾ç½®
        switch(idOrValue) {
          case '_pc_fillColor':
            // è®¾ç½®æ¶²ä½“é¢œè‰²
            if (waterShape) {
              waterShape.style.fill = value;
              waterShape.setAttribute('fill', value);
            }
            if (bulb) {
              bulb.style.fill = value;
              bulb.setAttribute('fill', value);
            }
            console.log('ðŸŽ¨ è®¾ç½®æ¶²ä½“é¢œè‰²:', value);
            // ç¡®ä¿ç»“æž„æ€§å…ƒç´ ä¸å—å½±å“
            restoreStructuralColors();
            break;
          case '_pn_value':
            _pn_value = parseFloat(value);
            console.log('ðŸŒ¡ï¸ è®¾ç½®æ¸©åº¦å€¼:', _pn_value);
            // æ›´æ–°æ¶²ä½é«˜åº¦
            updateLiquidLevel(_pn_value);
            break;
          case '_pn_min':
            _pn_min = parseFloat(value);
            break;
          case '_pn_max':
            _pn_max = parseFloat(value);
            break;
          case '_pc_textColor':
            // è®¾ç½®æ–‡æœ¬é¢œè‰²
            if (labelElement) {
              labelElement.style.fill = value;
              labelElement.setAttribute('fill', value);
            }
            console.log('ðŸŽ¨ è®¾ç½®æ–‡æœ¬é¢œè‰²:', value);
            break;
          case '_pn_textSize':
            // è®¾ç½®æ–‡æœ¬å¤§å°
            if (labelElement) {
              labelElement.style.fontSize = value;
              labelElement.setAttribute('font-size', value);
            }
            console.log('ðŸ“ è®¾ç½®æ–‡æœ¬å¤§å°:', value);
            break;
        }
      }

      // ðŸ”‘ æš´éœ²æŽ¥å£ï¼ˆå…¼å®¹è¿›åº¦æ¡åŠ¨ç”»ï¼‰
      svgRoot.__svgInstance = {
        putValue: putValue,
        getValue: function() { return _pn_value; },
        initValue: initValue,
        _pn_value: _pn_value,
        _pn_min: _pn_min,
        _pn_max: _pn_max
      };

      console.log('âœ… æ¸©åº¦è®¡ putValue å‡½æ•°å·²æš´éœ²åˆ° __svgInstance');

      // åˆå§‹åŒ–
      setTimeout(function() {
        // è®¾ç½®æ ·å¼ä¿æŠ¤
        setupStyleProtection();
        // æ¢å¤ç»“æž„æ€§é¢œè‰²
        restoreStructuralColors();
        // åŒæ­¥çƒæ³¡é¢œè‰²
        syncBulbColor();
        // è®¾ç½®æ ‡ç­¾æ›´æ–°
        setupLabelUpdate();
        // è®¾ç½®åˆå§‹æ¶²ä½ï¼ˆä½¿ç”¨å½“å‰çš„_pn_valueè€Œä¸æ˜¯ç¡¬ç¼–ç çš„initValueï¼‰
        updateLiquidLevel(_pn_value);

        console.log('ðŸŒ¡ï¸ æ¸©åº¦è®¡åˆå§‹åŒ–å®Œæˆï¼Œå½“å‰æ¸©åº¦:', _pn_value + 'â„ƒ');
      }, 100);
    })();
    ]]>
  </script>
</svg>
