# 本地路由配置说明

## 概述

本项目已配置为使用**本地静态路由**，登录后不再从后端接口获取动态路由。所有路由都在前端代码中定义。

## 修改内容

### 1. 路由初始化修改

**文件**: `src/router/utils.ts`

修改了 `initRouter()` 函数，不再调用后端接口 `getAsyncRoutes()`，而是直接使用本地定义的静态路由。

```typescript
/** 初始化路由（使用本地静态路由）*/
function initRouter() {
  return new Promise(resolve => {
    // 直接使用空数组，表示不添加任何动态路由
    // 所有路由都通过 src/router/modules 目录下的文件定义
    handleAsyncRoutes([]);
    resolve(router);
  });
}
```

### 2. 清理未使用的导入

移除了以下不再需要的导入：

- `getAsyncRoutes` - 后端路由接口
- `storageLocal` - 本地缓存（用于缓存动态路由）
- `getConfig` - 配置获取（用于判断是否缓存动态路由）
- `userKey`, `DataInfo` - 用户信息相关
- `routerArrays` - 路由数组

## 路由定义位置

### 静态路由模块

所有路由都在 `src/router/modules/` 目录下定义：

```
src/router/modules/
├── home.ts          # 首页路由
├── error.ts         # 错误页面路由
└── remaining.ts     # 其他不参与菜单的路由
```

### 添加新路由的方法

#### 方法1：创建新的路由模块（推荐）

在 `src/router/modules/` 目录下创建新的 `.ts` 文件，例如 `system.ts`：

```typescript
import { $t } from "@/plugins/i18n";
const Layout = () => import("@/layout/index.vue");

export default {
  path: "/system",
  name: "System",
  component: Layout,
  redirect: "/system/user",
  meta: {
    icon: "ep/setting",
    title: "系统管理",
    rank: 10
  },
  children: [
    {
      path: "/system/user",
      name: "SystemUser",
      component: () => import("@/views/system/user/index.vue"),
      meta: {
        title: "用户管理",
        showLink: true
      }
    },
    {
      path: "/system/role",
      name: "SystemRole",
      component: () => import("@/views/system/role/index.vue"),
      meta: {
        title: "角色管理",
        showLink: true
      }
    }
  ]
} satisfies RouteConfigsTable;
```

**注意**：

- 文件会被自动导入，无需手动引入
- `remaining.ts` 文件除外（该文件用于定义不参与菜单的路由）

#### 方法2：在 remaining.ts 中添加（不显示在菜单中）

对于不需要显示在菜单中的页面（如详情页、编辑页等），在 `src/router/modules/remaining.ts` 中添加：

```typescript
{
  path: "/scadafuxa/editor/:id",
  name: "ScadaFuxaEditor",
  component: () => import("@/views/scadafuxa/editor/index.vue"),
  meta: {
    title: "Fuxa组态编辑器",
    showLink: false,  // 不显示在菜单中
    rank: 123
  }
}
```

## 路由配置说明

### Meta 配置项

```typescript
meta: {
  title: "页面标题",           // 页面标题，支持国际化
  icon: "ep/home-filled",      // 菜单图标
  showLink: true,              // 是否在菜单中显示
  rank: 1,                     // 排序权重，数字越小越靠前
  roles: ["admin"],            // 权限角色（可选）
  keepAlive: true,             // 是否缓存页面（可选）
  frameSrc: "url",             // iframe地址（可选）
  extraIcon: "iconify-icon",   // 额外图标（可选）
}
```

### 路由层级说明

1. **一级路由**：使用 `Layout` 组件作为父容器
2. **二级及以下路由**：直接定义在 `children` 数组中
3. **三级及以上路由**：系统会自动拍平为二级路由

## SCADA组态系统路由示例

当前系统已配置的 SCADA 路由（在 `remaining.ts` 中）：

```typescript
// ========== SCADA组态系统路由 ==========
{
  path: "/scadafuxa/project/index",
  name: "ScadaFuxaProject",
  component: () => import("@/views/scadafuxa/project/index.vue"),
  meta: {
    title: "组态项目管理",
    showLink: false,
    rank: 120
  }
},
{
  path: "/scadafuxa/project/create",
  name: "ScadaFuxaProjectCreate",
  component: () => import("@/views/scadafuxa/project/form.vue"),
  meta: {
    title: "创建组态项目",
    showLink: false,
    rank: 121
  }
},
{
  path: "/scadafuxa/project/edit/:id",
  name: "ScadaFuxaProjectEdit",
  component: () => import("@/views/scadafuxa/project/form.vue"),
  meta: {
    title: "编辑组态项目",
    showLink: false,
    rank: 122
  }
},
{
  path: "/scadafuxa/editor/:id",
  name: "ScadaFuxaEditor",
  component: () => import("@/views/scadafuxa/editor/index.vue"),
  meta: {
    title: "Fuxa组态编辑器",
    showLink: false,
    rank: 123
  }
}
```

## 优势

使用本地静态路由的优势：

1. ✅ **简化架构**：无需后端路由接口，减少依赖
2. ✅ **提升性能**：避免登录后额外的路由请求
3. ✅ **便于维护**：所有路由在前端统一管理
4. ✅ **开发友好**：路由修改即时生效，无需后端配合
5. ✅ **类型安全**：TypeScript 提供完整的类型检查

## 权限控制

虽然使用本地路由，但仍然支持权限控制：

```typescript
meta: {
  roles: ["admin", "editor"],  // 只有这些角色可以访问
}
```

在路由守卫中会检查用户角色：

```typescript
// src/router/index.ts
if (to.meta?.roles && !isOneOfArray(to.meta?.roles, userInfo?.roles)) {
  next({ path: "/error/403" });
}
```

## 注意事项

1. **路由文件命名**：`src/router/modules/` 下的文件会自动导入（除了 `remaining.ts`）
2. **路由 name 必须唯一**：每个路由的 `name` 属性必须全局唯一
3. **组件路径**：使用动态导入 `() => import("@/views/...")`
4. **rank 排序**：数字越小，菜单位置越靠前
5. **Layout 组件**：一级菜单必须使用 `Layout` 作为父组件

## 如需恢复后端动态路由

如果将来需要恢复从后端获取路由，只需在 `src/router/utils.ts` 中取消注释原来的代码即可。

---

**修改日期**: 2025-10-17  
**修改人**: GitHub Copilot  
**相关文件**: `src/router/utils.ts`, `src/router/modules/remaining.ts`
