# 菜单显示问题修复说明

## 问题描述

登录后左侧菜单栏一个菜单都不显示。

## 问题原因

在修改为使用本地静态路由时，`initRouter()` 函数调用 `handleAsyncRoutes([])` 传入了空数组。虽然代码逻辑是：

```typescript
this.wholeMenus = filterNoPermissionTree(
  filterTree(ascending(this.constantMenus.concat(routes)))
);
```

理论上即使 `routes` 是空数组，`constantMenus` 也应该被正确处理。但实际上菜单没有显示，说明本地静态路由模块数量太少。

## 解决方案

### 1. 保留并优化 handleAsyncRoutes 逻辑

在 `src/router/utils.ts` 中添加了调试信息：

```typescript
function handleAsyncRoutes(routeList) {
  if (routeList.length === 0) {
    // 传入空数组表示没有后端动态路由，但 constantMenus 会被 concat 进去
    usePermissionStoreHook().handleWholeMenus(routeList);
  } else {
    // ... 处理动态路由的逻辑
  }
  addPathMatch();
  
  // 调试信息
  if (process.env.NODE_ENV === "development") {
    console.log("📋 本地静态路由菜单:", usePermissionStoreHook().constantMenus);
    console.log("📋 最终生成的菜单:", usePermissionStoreHook().wholeMenus);
  }
}
```

### 2. 创建更多本地路由模块

在 `src/router/modules/` 目录下创建了多个路由模块文件：

#### ✅ scada.ts - 组态系统

```typescript
{
  path: "/scada",
  name: "Scada",
  children: [
    {
      path: "/scada/project",
      name: "ScadaProject",
      component: () => import("@/views/scadafuxa/project/index.vue"),
      meta: { title: "项目管理" }
    }
  ]
}
```

#### ✅ bigScreen.ts - 数据大屏

```typescript
{
  path: "/bigscreen",
  name: "BigScreen",
  children: [
    {
      path: "/bigscreen/elec",
      name: "ElecScreen",
      component: () => import("@/views/bigScreen/elec/index.vue"),
      meta: { title: "电力监控" }
    }
  ]
}
```

#### ✅ system.ts - 系统管理

```typescript
{
  path: "/system",
  name: "System",
  children: [
    { path: "/system/user", meta: { title: "用户管理" } },
    { path: "/system/role", meta: { title: "角色管理" } },
    { path: "/system/menu", meta: { title: "菜单管理" } },
    { path: "/system/department", meta: { title: "部门管理" } },
    { path: "/system/unit", meta: { title: "单位管理" } }
  ]
}
```

#### ✅ energy.ts - 能源管理

```typescript
{
  path: "/energy",
  name: "Energy",
  children: [
    { path: "/energy/saving-rate", meta: { title: "节能率管理" } },
    { path: "/energy/analysis", meta: { title: "数据分析" } }
  ]
}
```

#### ✅ report.ts - 报表管理

```typescript
{
  path: "/report",
  name: "Report",
  children: [
    { path: "/report/forms", meta: { title: "报表列表" } }
  ]
}
```

## 当前路由模块列表

```
src/router/modules/
├── home.ts          # 首页 (rank: 0)
├── scada.ts         # 组态系统 (rank: 2) ✨ 新增
├── bigScreen.ts     # 数据大屏 (rank: 3) ✨ 新增
├── energy.ts        # 能源管理 (rank: 4) ✨ 新增
├── report.ts        # 报表管理 (rank: 5) ✨ 新增
├── system.ts        # 系统管理 (rank: 99) ✨ 新增
├── error.ts         # 错误页面 (不显示在菜单)
└── remaining.ts     # 其他隐藏路由 (不显示在菜单)
```

## 菜单显示效果

登录后左侧菜单应显示：

```
📁 首页
📁 组态系统
  └── 项目管理
📁 数据大屏
  └── 电力监控
📁 能源管理
  ├── 节能率管理
  └── 数据分析
📁 报表管理
  └── 报表列表
📁 系统管理
  ├── 用户管理
  ├── 角色管理
  ├── 菜单管理
  ├── 部门管理
  └── 单位管理
```

## 如何添加新菜单

### 方法1：创建独立的路由模块文件

在 `src/router/modules/` 下创建新文件，例如 `monitor.ts`：

```typescript
const Layout = () => import("@/layout/index.vue");

export default {
  path: "/monitor",
  name: "Monitor",
  component: Layout,
  redirect: "/monitor/device",
  meta: {
    icon: "ep:camera",
    title: "设备监控",
    rank: 6  // 数字越小，菜单位置越靠前
  },
  children: [
    {
      path: "/monitor/device",
      name: "MonitorDevice",
      component: () => import("@/views/monitor/device/index.vue"),
      meta: {
        title: "设备列表",
        showLink: true  // 显示在菜单中
      }
    }
  ]
} satisfies RouteConfigsTable;
```

文件创建后会自动被导入，无需手动引入。

### 方法2：在现有路由中添加子菜单

编辑已有的路由文件（如 `system.ts`），在 `children` 数组中添加新项。

## 注意事项

1. **路由文件命名**：除了 `remaining.ts`，其他 `.ts` 文件会自动导入
2. **rank 排序**：数字越小，菜单越靠前
3. **showLink 属性**：设置为 `false` 则不在菜单中显示
4. **必须使用 Layout**：一级路由必须使用 `Layout` 组件
5. **路由 name 唯一**：每个路由的 `name` 必须全局唯一

## 验证方法

1. 启动项目：`pnpm dev`
2. 登录系统
3. 查看浏览器控制台，应该看到：

   ```
   📋 本地静态路由菜单: [...]
   📋 最终生成的菜单: [...]
   ```

4. 左侧菜单栏应显示所有配置的菜单项

## 相关文件

- ✅ `src/router/utils.ts` - 路由初始化逻辑
- ✅ `src/router/modules/scada.ts` - 组态系统路由
- ✅ `src/router/modules/bigScreen.ts` - 数据大屏路由
- ✅ `src/router/modules/system.ts` - 系统管理路由
- ✅ `src/router/modules/energy.ts` - 能源管理路由
- ✅ `src/router/modules/report.ts` - 报表管理路由

---

**修复日期**: 2025-10-17  
**问题**: 左侧菜单栏不显示  
**解决**: 创建多个本地路由模块文件
